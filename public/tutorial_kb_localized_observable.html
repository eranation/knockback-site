<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><title>Tutorial: kb.LocalizedObservable</title><link rel="stylesheet" href="vendor/stylesheets/bootstrap.min.css"><link rel="stylesheet" href="stylesheets/layout.css"><link rel="stylesheet" href="stylesheets/layout_components.css"><script type="application/javascript" src="vendor/javascripts/jquery-1.7.2.js"></script><link rel="stylesheet" href="stylesheets/tutorial.css"><script type="application/javascript" src="vendor/javascripts/knockout-2.1.0.debug.js"></script><script type="application/javascript" src="vendor/javascripts/underscore-1.3.1.js"></script><script type="application/javascript" src="vendor/javascripts/backbone-0.9.2.js"></script><script type="application/javascript" src="vendor/javascripts/knockback-0.15.1.js"></script><script type="application/javascript" src="vendor/javascripts/globalize/globalize.js"></script><script type="application/javascript" src="vendor/javascripts/globalize/globalize.culture.en-GB.js"></script><script type="application/javascript" src="vendor/javascripts/globalize/globalize.culture.fr-FR.js"></script><link rel="stylesheet" href="vendor/lib/highlight/highlightjs/stylesheets/dark.css"><script type="application/javascript" src="vendor/lib/highlight/highlightjs/highlight.js"></script><script type="application/javascript" src="vendor/lib/highlight/highlightjs/languages/javascript.js"></script><script type="application/javascript" src="vendor/lib/highlight/highlight-coffee.js"></script><script type="application/javascript" src="vendor/javascripts/bootstrap.js"></script><script type="application/javascript" src="javascripts/interface.js"></script><script type="application/javascript">hljs.tabReplace = '  ';
hljs.initHighlightingOnLoad();</script></head><body><div id="wrap"><div class="page navbar"><div class="navbar page"><div class="navbar-inner"><div class="container"><a class="brand kb">Knockback.js</a><ul class="nav"><li><a href="index.html">Home</a></li><li><a href="tutorial_getting_started.html">Getting Started</a></li><li><a href="docs.html">Docs</a></li><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Tutorials<b class="caret"></b></a><ul class="dropdown-menu"><li></li><a href="tutorial_getting_started.html">Getting Started</a><a href="tutorial_kb_view_model.html">kb.ViewModel</a><a href="tutorial_kb_observable_options.html">kb.Observable Options</a><a href="tutorial_kb_localized_observable.html">kb.LocalizedObservable</a><a href="tutorial_relational_models.html">Relational Models</a><a href="tutorial_locale_manager.html">Custom Locale Manager</a><a href="tutorial_todos_app.html">Todos App</a></ul></li><li><a href="release_notes.html">Release Notes</a></li></ul><div id="script_language"><div class="separator"><div class="selection codestyle"><div class="option"><input id="cs-cs" type="radio" name="codestyle" value="cs" class="auto"/><label for="cs-cs">CoffeeScript</label></div><div class="option"><input id="cs-js" type="radio" name="codestyle" value="js"/><label for="cs-js">Javascript</label></div></div></div></div></div></div></div></div></div><div id="wrap"><div class="page container"><header class="page"></header><content class="page"><section><h1>Tutorial: kb.LocalizedObservable</h1><p><a href="index.html">Knockback.js</a><span> uses a convention of storing your custom Locale Manager in 'kb.locale_manager' so that it can be globally used to localize aspects of your application (please see the </span><a href="tutorial_locale_manager.html">Custom Locale Manager</a><span> tutorial for usage examples). </span></p><p><span>The </span><a href="docs_kb_Localized_observable.html">kb.LocalizedObservable</a><span> watches the 'kb.locale_manager' instance for changes and updates itself accordingly.</span></p><p><span class="label label-important">warning</span><span> This is one of the few cases where you are likely to derive from a Knockback class and where you need to know about </span><span class="label label-warning">observable returned</span><span>. Basically, when you derive your own type of kb.LocalizedObservable, you need to return the wrapped observable rather than the instance itself from the constructor using </span><a href="docs_kb_utils.html#wrapped_observable">kb.utils.wrappedObservable</a></p><p><span>We'll use the following Locale Manager for these examples:</span><pre data-for="cs">class LocaleManager
  constructor: (locale_identifier, @translations_by_locale) ->
    @current_locale = ko.observable(locale_identifier)

  get: (string_id) ->
    return '(no translation)' unless @translations_by_locale[@current_locale()]
    return '(no translation)' unless @translations_by_locale[@current_locale()].hasOwnProperty(string_id)
    return @translations_by_locale[@current_locale()][string_id]

  getLocale: -> return @current_locale()
  setLocale: (locale_identifier) ->
    @current_locale(locale_identifier)
    @trigger('change', @)

_.extend(LocaleManager.prototype, Backbone.Events)

kb.locale_manager = new LocaleManager('en-GB', {
  'en-GB':
    body: 'I ought to localize this sentence.'
  'fr-FR':
    body: 'J\'ai besoin de localiser cette phrase.'
})
</pre><pre data-for="js">var LocaleManager = function(locale_identifier, translations_by_locale) {
  this.translations_by_locale = translations_by_locale;
  this.current_locale = ko.observable(locale_identifier);

  this.get = function(string_id) {
    if (!this.translations_by_locale[this.current_locale()]) {
      return '(no translation)';
    }
    if (!this.translations_by_locale[this.current_locale()].hasOwnProperty(string_id)) {
      return '(no translation)';
    }
    return this.translations_by_locale[this.current_locale()][string_id];
  };

  this.getLocale = function() {
    return this.current_locale();
  };

  this.setLocale = function(locale_identifier) {
    this.current_locale(locale_identifier);
    return this.trigger('change', this);
  };
};

_.extend(LocaleManager.prototype, Backbone.Events);

kb.locale_manager = new LocaleManager('en-GB', {
  'en-GB': {
    body: 'I ought to localize this sentence.'
  },
  'fr-FR': {
    body: 'J\'ai besoin de localiser cette phrase.'
  }
});
</pre><script type="application/javascript" src="tutorials/kb_localized_observable/kblo_locale_manager.js"></script></p><p></p><h3>Nested String Id</h3><p></p><p>If you want to simply localize some read-only text based on a nested string id, you typically use a ko.Observable to access the attribute with the string id and use a localizer that simply looks up the string in the kb.locale_manager.</p><div class="container-fluid"><div class="row-fluid"><div class="span8"><h4>Custom kb.LocalizedObservable:</h4><pre data-for="cs">LocalizedStringLocalizer = kb.LocalizedObservable.extend({
  constructor: (value, options, view_model) ->
    kb.LocalizedObservable.prototype.constructor.apply(this, arguments)
    return kb.utils.wrappedObservable(@)

  read: (string_id) ->
    return if (string_id) then kb.locale_manager.get(string_id) else ''
})</pre><pre data-for="js">// Generated by CoffeeScript 1.3.1
var LocalizedStringLocalizer;

LocalizedStringLocalizer = kb.LocalizedObservable.extend({
  constructor: function(value, options, view_model) {
    kb.LocalizedObservable.prototype.constructor.apply(this, arguments);
    return kb.utils.wrappedObservable(this);
  },
  read: function(string_id) {
    if (string_id) {
      return kb.locale_manager.get(string_id);
    } else {
      return '';
    }
  }
});
</pre><h4>Views:</h4><pre>&lt;div id='kblo_read_only'&gt;
  &lt;p data-bind=&quot;text: main_text&quot;&gt;&lt;/p&gt;

  &lt;p&gt;
    &lt;span&gt;Current Locale: &lt;span&gt;
    &lt;span data-bind=&quot;text: kb.locale_manager.getLocale()&quot;&gt;&lt;span&gt;
  &lt;/p&gt;
  &lt;button data-bind=&quot;click: toggleLocale&quot;&gt;Toggle Locale&lt;/button&gt;
&lt;/div&gt;</pre><h4>ViewModel and Bindings:</h4><pre data-for="cs">texts = new Backbone.Model({main_text_id: 'body'})

view_model =
  main_text: kb.observable(texts, {key: 'main_text_id', localizer: LocalizedStringLocalizer})
  toggleLocale: ->
    if (kb.locale_manager.getLocale() == 'en-GB')
      kb.locale_manager.setLocale('fr-FR')
    else
      kb.locale_manager.setLocale('en-GB')

ko.applyBindings(view_model, $('#kblo_read_only')[0])</pre><pre data-for="js">// Generated by CoffeeScript 1.3.1
var texts, view_model;

texts = new Backbone.Model({
  main_text_id: 'body'
});

view_model = {
  main_text: kb.observable(texts, {
    key: 'main_text_id',
    localizer: LocalizedStringLocalizer
  }),
  toggleLocale: function() {
    if (kb.locale_manager.getLocale() === 'en-GB') {
      return kb.locale_manager.setLocale('fr-FR');
    } else {
      return kb.locale_manager.setLocale('en-GB');
    }
  }
};

ko.applyBindings(view_model, $('#kblo_read_only')[0]);
</pre></div><div class="span4"><h4>Live Result</h4><div class="demos_result_box"><div id='kblo_read_only'>
  <p data-bind="text: main_text"></p>

  <p>
    <span>Current Locale: <span>
    <span data-bind="text: kb.locale_manager.getLocale()"><span>
  </p>
  <button data-bind="click: toggleLocale">Toggle Locale</button>
</div><script type="application/javascript" src="tutorials/kb_localized_observable/kblo_string_id_models.js"></script><script type="application/javascript" src="tutorials/kb_localized_observable/kblo_string_id_view_model_bindings.js"></script></div></div></div></div><p></p><h3 id="localized_input">Localized Input</h3><p></p><p>If you want to simply label an input field, you can use a read-only localized observable that only looks up the string in the kb.locale_manager.</p><div class="container-fluid"><div class="row-fluid"><div class="span8"><h4>Custom kb.LocalizedObservable:</h4><pre data-for="cs">LongDateLocalizer = kb.LocalizedObservable.extend({
  constructor: (value, options, view_model) ->
    kb.LocalizedObservable.prototype.constructor.apply(this, arguments)
    return kb.utils.wrappedObservable(@)

  read: (value) ->
    return Globalize.format(value, 'dd MMMM yyyy', kb.locale_manager.getLocale())

  write: (localized_string, value) ->
    new_value = Globalize.parseDate(localized_string, 'dd MMMM yyyy', kb.locale_manager.getLocale())

    # reset if invalid
    if not (new_value and _.isDate(new_value))
      return kb.utils.wrappedObservable(this).resetToCurrent()

    value.setTime(new_value.valueOf())
})</pre><pre data-for="js">// Generated by CoffeeScript 1.3.1
var LongDateLocalizer;

LongDateLocalizer = kb.LocalizedObservable.extend({
  constructor: function(value, options, view_model) {
    kb.LocalizedObservable.prototype.constructor.apply(this, arguments);
    return kb.utils.wrappedObservable(this);
  },
  read: function(value) {
    return Globalize.format(value, 'dd MMMM yyyy', kb.locale_manager.getLocale());
  },
  write: function(localized_string, value) {
    var new_value;
    new_value = Globalize.parseDate(localized_string, 'dd MMMM yyyy', kb.locale_manager.getLocale());
    if (!(new_value && _.isDate(new_value))) {
      return kb.utils.wrappedObservable(this).resetToCurrent();
    }
    return value.setTime(new_value.valueOf());
  }
});
</pre><h4>Views:</h4><pre>&lt;div id='kblo_read_write'&gt;
  &lt;input data-bind=&quot;value: date&quot;/&gt;

  &lt;p&gt;
    &lt;span&gt;Current Locale: &lt;span&gt;
    &lt;span data-bind=&quot;text: kb.locale_manager.getLocale()&quot;&gt;&lt;span&gt;
  &lt;/p&gt;
  &lt;button data-bind=&quot;click: toggleLocale&quot;&gt;Toggle Locale&lt;/button&gt;
&lt;/div&gt;</pre><h4>ViewModel and Bindings:</h4><pre data-for="cs">model = new Backbone.Model({date: new Date()})

view_model =
  date: kb.observable(model, {key: 'date', localizer: LongDateLocalizer})
  toggleLocale: ->
    if (kb.locale_manager.getLocale() == 'en-GB')
      kb.locale_manager.setLocale('fr-FR')
    else
      kb.locale_manager.setLocale('en-GB')

ko.applyBindings(view_model, $('#kblo_read_write')[0])</pre><pre data-for="js">// Generated by CoffeeScript 1.3.1
var model, view_model;

model = new Backbone.Model({
  date: new Date()
});

view_model = {
  date: kb.observable(model, {
    key: 'date',
    localizer: LongDateLocalizer
  }),
  toggleLocale: function() {
    if (kb.locale_manager.getLocale() === 'en-GB') {
      return kb.locale_manager.setLocale('fr-FR');
    } else {
      return kb.locale_manager.setLocale('en-GB');
    }
  }
};

ko.applyBindings(view_model, $('#kblo_read_write')[0]);
</pre></div><div class="span4"><h4>Live Result</h4><div class="demos_result_box"><div id='kblo_read_write'>
  <input data-bind="value: date"/>

  <p>
    <span>Current Locale: <span>
    <span data-bind="text: kb.locale_manager.getLocale()"><span>
  </p>
  <button data-bind="click: toggleLocale">Toggle Locale</button>
</div><script type="application/javascript" src="tutorials/kb_localized_observable/kblo_localized_input_models.js"></script><script type="application/javascript" src="tutorials/kb_localized_observable/kblo_localized_input_view_model_bindings.js"></script></div></div></div></div></section></content><footer class="page"></footer></div></div></body></html>